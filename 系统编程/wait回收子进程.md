## wait函数

```C
pid_t wait(int *status); 	
```

```C
// 成功：清理掉子进程ID；失败：-1 (没有子进程)； 参数为传出参数
// 当进程终止时，操作系统的隐式回收机制会：
// 1.关闭所有文件描述符 
// 2. 释放用户空间分配的内存。内核的PCB仍存在。其中status保存该进程的退出状态。(正常终止→返回值；异常终止→终止信号值)
```

wait函数的三个作用：

- 阻塞等待子进程退出 (这个功能可以使父进程不与子进程竞争CPU分片，好让子进程先执行)。
- 回收子进程残留资源 。
- 获取子进程结束状态(退出原因)。

一个进程在终止时会关闭所有文件描述符，释放在用户空间分配的内存，但它的PCB还保留着，内核在其中保存了一些信息：如果是正常终止则保存着退出状态，如果是异常终止则保存着导致该进程终止的信号是哪个。

这个进程的父进程可以调用wait或waitpid获取这些信息，然后彻底清除掉这个进程。我们知道一个进程的退出状态可以在Shell中用特殊变量`$?`查看，因为Shell是它的父进程，当它终止时Shell调用wait或waitpid得到它的退出状态同时彻底清除掉这个进程。

即上面的意思就是，若我们不想产生僵尸进程的话，那么未死亡的父进程就需要先调用wait函数回收死亡的子进程的资源，防止产生僵尸进程。

## waitpid函数

waitpid函数具有和wait函数一样的功能，也就是每次调用只回收一个子进程。但是waitpid函数可以通过设置参数1来回收多个子进程。并且可以设置非阻塞。详细如下：

## 文章参考

[(117条消息) 16进程学习之wait回收子进程并且获取正常退出的返回值和异常退出的信号值_Mango酱的博客-CSDN博客](https://blog.csdn.net/weixin_44517656/article/details/109453889)

